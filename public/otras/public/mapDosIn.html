


<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Data visualization-responsive"/>
      
      <title> MAPA </title>

      <!-- Bootsrtap -->
      <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
      <script src="https://use.fontawesome.com/67f92cb474.js"></script>

      <!-- d3 -->
      <script src="http://lobohornosindustriales.com.mx/d3.min.js" ></script>
      <script src="http://lobohornosindustriales.com.mx/topojson.v2.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>




    <style>
      .todoBox {
        padding: 15px;
      }

        path {
            stroke: #ededed;
            stroke-width: 2px;
        }


      .btn{
        background-color: #0993e2;
        font-size: 18px;
        font-weight: bold;
        color: white;
      }

      #btnInfo{
        position: relative;
        width: 100px;
        height: auto;
        background-color:#c9c9c9;
        display: flex;
        padding: 5px;
        margin: 0px;
      }

      .zoomP {
        position: relative;
        width: 100px;
        height: 30px;
        font-size: 24px;
        color: #0993e2;
        padding: 5px;
        margin: 0px;
      }

      #btnInfo button{
        position: relative;
        width: 400px;
        height: 40px;
        margin: auto;
        background-color: #0993e2;
        color: white;
        font-weight: bold;
        font-size: 24px;
      }

      #container{
        position: relative;
        width: 100%;
        height: auto;
        border:1px solid orange;
      }

      #searchPop{
        position: absolute;
        max-width: 360px;
        min-width: 350px;
        overflow: hidden;
        margin: 0 auto;
        left: 0;
        right: 0;
        height: 100%;
        background-color:rgba(255,255,255,0.8);
        top:0px;
        z-index: 1000;
        display: none;
        text-align:center;
        -moz-box-shadow: 0 0 10px rgba(0,0,0,.18); /* drop shadow */
        -webkit-box-shadow: 0 0 10px rgba(0,0,0,.18); /* drop shadow */
        -o-box-shadow: 0 0 10px rgba(0,0,0,.18); /* drop shadow */
        box-shadow: 0 0 10px rgba(0,0,0,.18); /* drop shadow */
        -webkit-transform-origin:top center;
        -moz-transform-origin:top center;
        -o-transform-origin:top center;
        transform-origin:top center;
        -webkit-animation: iconosani 1.2s forwards;
        animation: iconosani 1.2s forwards;
        -moz-animation: iconosani 1.2s forwards;
        -o-animation: iconosani 1.2s forwards;
      }


          @-webkit-keyframes iconosani {
              0% {
                  -webkit-transform: perspective(800px) rotateX(-90deg);
                  -moz-transform: perspective(800px) rotateX(-90deg);
                  -o-transform: perspective(800px) rotateX(-90deg);
                  opacity: 1;
              } 
              40% {
                  -webkit-transform: perspective(800px) rotateX(30deg);
                  -moz-transform: perspective(800px) rotateX(30deg);
                  -o-transform: perspective(800px) rotateX(30deg);
                  opacity: 1;
              }
              70% {
                  -webkit-transform: perspective(800px) rotateX(-10deg);
                  -moz-transform: perspective(800px) rotateX(-10deg);
                  -o-transform: perspective(800px) rotateX(-10deg);
              }
              100% {
                  -webkit-transform: perspective(800px) rotateX(0deg);
                  -moz-transform: perspective(800px) rotateX(0deg);
                  -o-transform: perspective(800px) rotateX(0deg);
                  opacity: 1;
              }
          }



      #searchPop p{
        position: relative;
        width:300px;
        height: auto;
        margin: auto;
        font-size: 24px;
        font-weight: bold;
        color: black;
        text-align: center;
      }


      #searchPop p img{
        -webkit-filter: grayscale(100%) brightness(250%) contrast(100%) saturate(750%);
      }


      #searchPop p span:nth-child(4) {
          background: #0993e2;
          padding: 4px;
          font-size: 18px;
      }


      .background {
        fill: none;
        pointer-events: all;
      }

      #states {
        fill: #aaa;
      }

      #states .active {
        fill: #7fd1ca;
      }

      #state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 1.5px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
      }

    div.tooltip {
      position: absolute;
      width: 280px;
      height: 210px;
      padding: 4px;
      font: 11px sans-serif;
      background: orange;
      border: 0px;
      border-radius: 2px;
      pointer-events: none;
      color: white;
      display: none;
   }
   div.tooltipAAA {
      position: absolute;
      width: 280px;
      height: auto;
      padding: 4px;
      font: 11px sans-serif;
      background: green;
      border: 0px;
      border-radius: 2px;
      pointer-events: none;
      color: white;
      display: none;
   }
   h1{
    position: relative;
    width: auto;
    height: 20px;
    padding: 2px;
    margin:0px;
   }
   .fa.fa-plane{
    font-size: 24px;
    padding: 2px;
   }
  .l1, .l2, .l3, .l4{
    position: relative;
    float: none;
    padding: 5px;
    width: 25px;
    height: 25px;
    background-color: white;
  }

  /*#buscarBox {
    position: relative;
    width: 200px;
    height: 200px;
    border: 1px solid orange;
    left:-300px;
  }*/

  .acotacion{
    position: relative;
    width: 180px;
    height: 110px;
    background-color: white;
    float: right;
    right: 0px;
    top:25px;
  }
  .acotacion p{
    font-size: 21px;
    font-weight: bold;
  }
.simUno{
  position: relative;
  width: 100%;
}
.simUno > img {
    position: relative;
    width: 35px;
    height: 25px;
    float: left;
    margin-right:15px;
  }
.simUno > i {
    position: relative;
    width: 35px;
    height: 25px;
    float: left;
    font-size: 21px;
    text-align: center;
    margin-right:15px;
  }
  .simUno > span {
    position: relative;
    width: 80px;
    float: left;
  }


    </style>
 
</head>


<body>

<div class="row todoBox">

  <div class="col-md-3">
    <form>
      <label>Estado:</label>
      <br>
      <select id="selecId">
        <option selected="selected" >Selecciona el Estado</option>
        <option id="todosId" value="Todos">Todos</option>
        <option value="Aguascalientes">Aguascalientes</option>
        <option value="Baja California Norte">Baja California Norte</option>
        <option value="Baja California Sur">Baja California Sur</option>
        <option value="CDMX">CDMX</option>
        <option value="Campeche">Campeche</option>
        <option value="Chiapas">Chiapas</option>
        <option value="Chihuahua">Chihuahua</option>
        <option value="Colima">Colima</option>
        <option value="Coahuila">Coahuila</option>
        <option value="Estado de México">Edo. Mex.</option>
        <option value="Guerrero">Guerrero</option>
        <option value="Jalisco">Jalisco</option>
        <option value="Michoacan">Michoacán</option>
        <option value="Nuevo León">Nuevo León</option>
        <option value="Oaxaca">Oaxaca</option>
        <option value="Puebla">Puebla</option>
        <option value="Querétaro">Querétaro</option>
        <option value="Quintana Roo">Quintana Roo</option>
        <option value="Sinaloa">Sinaloa</option> 
        <option value="Sonora">Sonora</option>
        <option value="Tabasco">Tabasco</option>
        <option value="Tamaulipas">Tamaulipas</option>
        <option value="Veracruz">Veracruz</option>
        <option value="Yucatán">Yucatán</option>
      </select>
      <br><br>


      <label>Asociación:</label>
      <br>
      <select id="selecIdAs">
        <option selected="todosIdAs" >Selecciona la Asociación</option>
        <option id="todosId" value="Todas">Todas</option>
        <option value="CAAAREM">CAAAREM</option>
        <option value="AAA de Ciudad Acuña">AAA de Ciudad Acuña</option>
        <option value="AAA del Aeropuerto de México">AAA del Aeropuerto de México</option>
        <option value="AAA de Agua Prieta">AAA de Agua Prieta</option>
        <option value="AAA de Aguascalientes">AAA de Aguascalientes</option>
        <option value="AAA de Cancún">AAA de Cancún</option>
        <option value="AAA de Chihuahua">AAA de Chihuahua</option>
        <option value="AAA de Ciudad del Carmen">AAA de Ciudad del Carmen</option>
        <option value="AAA de Ciudad Hidalgo">AAA de Ciudad Hidalgo</option>
        <option value="AAA de Ciudad Juarez">AAA de Ciudad Juarez</option>
        <option value="AAA de Coatzacoalcos">AAA de Coatzacoalcos</option>
        <option value="AAA de Colombia, Nuevo León">AAA de Colombia, Nuevo León</option>
        <option value="AAA de Toluca">AAA de Toluca</option>
        <option value="AAA del Puerto de Guaymas">AAA del Puerto de Guaymas</option>
        <option value="AAA del Puerto de Manzanillo">AAA del Puerto de Manzanillo</option>
        <option value="AAA del Puerto Veracruz">AAA del Puerto Veracruz</option>
        <option value="AAA de Ensenada">AAA de Ensenada</option>
        <option value="AAA de Edo. de Nuevo León">AAA de Edo. de Nuevo León</option>
        <option value="AAA de Guadalajara">AAA de Guadalajara</option>
        <option value="AAA de Lázaro Cárdenas">AAA de Lázaro Cárdenas</option>
        <option value="AAA de H. Matamoros">AAA de H. Matamoros</option>
        <option value="AAA de Mazatlán">AAA de Mazatlán</option>
        <option value="AAA de Mexicali">AAA de Mexicali</option>
        <option value="AAA de Miguyel Alemán y Camargo">AAA de Miguyel Alemán y Camargo</option>
        <option value="AAA de Nogales">AAA de Nogales</option>
        <option value="AAA de Nuevo Laredo">AAA de Nuevo Laredo</option>
        <option value="AAA de Ojinaga">AAA de Ojinaga</option>
        <option value="AAA de Piedras Negrass">AAA de Piedras Negras</option>
        <option value="AAA de Puebla">AAA de Puebla</option>
        <option value="AAA de Reynosa">AAA de Reynosa</option>
        <option value="AAA de San Luis Rio Colorado">AAA de San Luis Rio Colorado</option>
        <option value="AAA de Subteninte López">AAA de Subteninte López</option>
        <option value="AAA de Tampico y Altamira">AAA de Tampico y Altamira</option>
        <option value="AAA de Tijuana y Tecate">AAA de Tijuana y Tecate</option>
        <option value="AAA de Tuxpan">AAA de Tuxpan</option>
        <option value="AAA de Yucatán">AAA de Yucatán</option>
      </select>
      <br><br>
    <div id="buscarBox">
      <label>Tráfico:</label>
      <br>
      <input id="todos" type="checkbox" checked name="fooby[1][]" value="todos" />
      <label id="labelTodos">Todos</label>
      <br />
      <input id="Aereo" class="others" type="checkbox" name="fooby[1][]" value="Aereo" />Aéreo<br />
      <input id="Maritimo" class="others"  type="checkbox" name="fooby[1][]" value="Maritimo" />Marítimo<br />
      <input id="Terrestre" class="others"  type="checkbox" name="fooby[1][]" value="Terrestre" />Terrestre<br />
      <input id="Ferroviario" class="others"  type="checkbox" name="fooby[1][]" value="Ferroviario" />Ferroviario
      <br />
      <br />
      <button id="target" class="btn">Buscar de Nuevo</button>
    </div>
    </form>
  </div>

  <div class="col-md-9">
    <div class="acotacion">
      <p>Simbología</p>
      <div class="simUno">
        <i class="fa fa-building-o" aria-hidden="true"></i>
        <span>Aduanas</span>
      </div>
      <br><br>
      <div class="simUno">
        <img src="http://www.congresocaaarem.com/caaarem/wp-content/uploads/2017/07/logobn-e1501185359196.jpg">
        <span>Asociación</span>
      </div>
    </div>
    <div id="container"></div>
  </div>

</div> <!-- END row -->






<script>

window.addEventListener('wheel', function(d) {
  var inR = 4;
  if (d.deltaY < 0) {
    console.log('scrolling up');
    svg.selectAll("circle")
      .attr("r", inR-2);
  }
  if (d.deltaY > 0) {
    console.log('scrolling down');
    svg.selectAll("circle")
      .attr("r", inR+0.5);
  }
});

$("input:checkbox").on( "click", function() { $("#selecIdAs").selectedIndex = 1 });

$("#reset").on("click", function () {
    $('#selecIdn').prop('selected', function() {
        return this.defaultSelected;
    });
});

$("input:checkbox").on('click', function() {
          var $box = $(this);
          if ($box.is(":checked")) {
            var group = "input:checkbox[name='" + $box.attr("name") + "']";
            $(group).prop("checked", false);
            $box.prop("checked", true);
          } else {
            $box.prop("checked", false);
          }
        });

var margin = { top: 10, right: 10, bottom: 10, left: 10 },
        width = parseInt(d3.select("#container").style('width'), 10),
        width = width - margin.left - margin.right,
        ratio = .5,
        height = width * ratio+10,
        centered,
        zoom = d3.behavior.zoom();

var projection = d3.geo.mercator()
            .center([-100, 22])
            .translate([ width/1.7, height/1.7])
            .scale([ width/.7 ]);

var path = d3.geo.path()
    .projection(projection);


//svg
var svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(d3.behavior.zoom().on("zoom", function () {
                svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
              })
            )
      .append("g");

d3.json("mexicoAs.json", function(json) {

        var div = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);
        var div2 = d3.select("body").append("div")
          .attr("class", "tooltipAAA")
          .style("opacity", 0); 


      //Append the tooltip divs
        var div = d3.select("body").append("div")
              .attr("class", "tooltip")
              .style("opacity", 0);

            svg.append("g")
                .attr("id", "states")
              .selectAll("path")
                .data(json.features)
              .enter().append("path")
                .attr("d", path)
                .attr("fill", "#bae6ef")
                    .append("title");

          // CSV PROCESS
          d3.csv("aduanasDatosMSDOS.csv", function(data) {

                  svg.selectAll("circle")
                      .data(data)
                      .enter()
                      .append("circle")
                      .attr("cx", function(d) {
                        return projection([d.lon, d.lat])[0];
                      })
                      .attr("cy", function(d) {
                        return projection([d.lon, d.lat])[1];
                      })
                      .attr("r", function(d) {
                        return Math.sqrt(d.radio) * 3;
                      })
                      .style("fill", "red")
                      .on("mouseover", function(d) {
                        d3.select(this).transition()
                          .ease("elastic")
                          .duration("500")
                          .attr("r", 10)
                          .style("fill", "#0087b5");

                          div.transition()        
                            .duration(200)      
                            .style("opacity", .9)
                            .style("display", "block");
                        
                          div.html('<h3>Aduana de: '+d.id +'</h3>' + '<p> Dirección:  '+d.Direccion+'</p>' + '<p><span>Tráfico:  </span>'+'<img class="l1"' + 'src="' +d.l1+ '">'  +'<img class="l2"' + 'src="' +d.l2+ '">' + '<img class="l3"' + 'src="' +d.l3+ '">' + '<img class="l4"' + 'src="' +d.l4+ '">' + '</p>'
                          )
                          .style("left", (d3.event.pageX) + "px")     
                          .style("top", (d3.event.pageY - 28) + "px");

                          div2.transition()        
                            .duration(200)      
                            .style("opacity", .9)
                            .style("display", "block");
                        
                          div2.html('<h5>'+d.AAA_Nombre +'</h5>' +'<p> Dirección: '+ d.AAA_Direccion +'</p>' + '<p> Teléfono: <b>'+ d.AAA_Telefono +'</b></p>' + '<p>E-mail:  '+ d.AAA_Email +'</p>'
                          )
                          .style("left", (d3.event.pageX) + "px")     
                          .style("top", (d3.event.pageY + 180) + "px");

                          if(d.l1 === "No"){
                            $(".l1").css("display", "none")
                          }
                          if(d.l2 === "No"){
                            $(".l2").css("display", "none")
                          }
                          if(d.l3 === "No"){
                            $(".l3").css("display", "none")
                          }
                          if(d.l4 === "No"){
                            $(".l4").css("display", "none")
                          }

                      })               
                      .on("mouseout", function(d) {
                        d3.select(this).transition()
                            .ease("quad")
                            .delay("100")
                            .duration("200")
                            .attr("r", 4)
                            .style("fill", "red"); 

                          div.transition()        
                             .duration(500)      
                             .style("opacity", 0)
                             .style("display", "none");
                          div2.transition()        
                             .duration(500)      
                             .style("opacity", 0)
                             .style("display", "none");
                      });






          


                var select = d3.select('#selecId')
                .data(data)
                  .on('change', function(d) {
                    $("#selecIdAs").each(function() { this.selectedIndex = 1 });

                    /* Animate Child-checkBoxes BOX */
                      $( "#buscarBox" ).animate({
                        left: "0px"
                      }, 1500 );

                    var selectValue = d3.select('#selecId').property('value');
                    var selectValueAs = d3.select('#selecIdAs').property('value');

                     svg.selectAll("circle")
                      .data(data)
                      .attr("cx", function(d) {
                          if(selectValue === "Todos" ){
                            return projection([d.lon, d.lat])[0];
                            console.log("Tooodos cx") 
                          }
                          else if(selectValue === d.Estado){
                            return projection([d.lon, d.lat])[0];
                          }
                          else { return projection(["0","0"])[0]; console.log("Tooodos NO") }      
                      })
                      .attr("cy", function(d) {
                          if(selectValue === "Todos" ){
                            return projection([d.lon, d.lat])[1];
                            console.log("Tooodos cy") 
                          }
                          else if(selectValue === d.Estado){
                            return projection([d.lon, d.lat])[1];
                          }
                          else { return projection(["0","0"])[1]; console.log("Tooodos NO") }
                      })
                      .attr("r", function(d) {
                        return Math.sqrt(d.radio) * 3;
                      })
                      .style("fill", "red")
                      .on("mouseover", function(d) {
                        d3.select(this).transition()
                          .ease("elastic")
                          .duration("500")
                          .attr("r", 10)
                          .style("fill", "#0087b5");

                          div.transition()        
                            .duration(200)      
                            .style("opacity", .9)
                            .style("display", "block");
                        
                          div.html('<h3>Aduana de: '+d.id +'</h3>' + '<p> Dirección:  '+d.Direccion+'</p>' + '<p><span>Tráfico:  </span>'+'<img class="l1"' + 'src="' +d.l1+ '">'  +'<img class="l2"' + 'src="' +d.l2+ '">' + '<img class="l3"' + 'src="' +d.l3+ '">' + '<img class="l4"' + 'src="' +d.l4+ '">' + '</p>'
                          )
                          .style("left", (d3.event.pageX) + "px")     
                          .style("top", (d3.event.pageY - 28) + "px");

                          div2.transition()        
                            .duration(200)      
                            .style("opacity", .9)
                            .style("display", "block");
                        
                          div2.html('<h5>'+d.AAA_Nombre +'</h5>' +'<p> Dirección: '+ d.AAA_Direccion +'</p>' + '<p> Teléfono: <b>'+ d.AAA_Telefono +'</b></p>' + '<p>E-mail:  '+ d.AAA_Email +'</p>'
                          )
                          .style("left", (d3.event.pageX) + "px")     
                          .style("top", (d3.event.pageY + 180) + "px");

                          if(d.l1 === "No"){
                            $(".l1").css("display", "none")
                          }
                          if(d.l2 === "No"){
                            $(".l2").css("display", "none")
                          }
                          if(d.l3 === "No"){
                            $(".l3").css("display", "none")
                          }
                          if(d.l4 === "No"){
                            $(".l4").css("display", "none")
                          }

                      })               
                      .on("mouseout", function(d) {
                        d3.select(this).transition()
                            .ease("quad")
                            .delay("100")
                            .duration("200")
                            .attr("r", 4)
                            .style("fill", "red"); 

                          div.transition()        
                             .duration(500)      
                             .style("opacity", 0)
                             .style("display", "none");
                          div2.transition()        
                             .duration(500)      
                             .style("opacity", 0)
                             .style("display", "none");
                      });


                  d3.select("#todos").on("change",update2);
                  d3.select("#Aereo").on("change",update);
                  d3.select("#Maritimo").on("change",update);
                  d3.select("#Terrestre").on("change",update);
                  d3.select("#Ferroviario").on("change",update);
                  update();

                  function update2(){
                    if( d3.select("#todos").property("checked") ){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          } 
                        })
                        .attr("cy", function(d) {
                          if(selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Todos C")
                    }

                  }
                  
                  function update(){


                    if(d3.select("#Aereo").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo === "Aereo" && selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo === "Aereo" && selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo === "Aereo" && selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo === "Aereo" && selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Aereo C")
                    } 
                    if(d3.select("#Maritimo").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo2 === "Maritimo" && selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo2 === "Maritimo" && selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo2 === "Maritimo" && selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo2 === "Maritimo" && selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Maritimo C")
                    }
                    if(d3.select("#Terrestre").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo3 === "Terrestre" && selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo3 === "Terrestre" && selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo3 === "Terrestre" && selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo3 === "Terrestre" && selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Terrestre C")
                    }
                    if(d3.select("#Ferroviario").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo4 === "Ferroviario" && selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo4 === "Ferroviario" && selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo4 === "Ferroviario" && selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo4 === "Ferroviario" && selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Ferroviario C")
                    }
                  };

              });  // END On chage (SELECT-OPTION-ESTADO)



              var selectAs = d3.select('#selecIdAs')
                .data(data)
                  .on('change', function(d) {

                    $("#selecId").each(function() { this.selectedIndex = 1 });
                    $('input[value=todos]').prop('checked', true);
                    $('.others').prop('checked', false);              

                    /* Animate Child-checkBoxes BOX */
                      $("#buscarBox").animate({
                        left: "0px"
                      }, 1500 );
                                     
                    svg.selectAll("circle")
                      .data(data)
                      .enter()
                      .append("circle")
                      .attr("cx", function(d) {
                        return projection([d.lon, d.lat])[0];
                      })
                      .attr("cy", function(d) {
                        return projection([d.lon, d.lat])[1];
                      })
                      .attr("r", function(d) {
                        return Math.sqrt(d.radio) * 3;
                      })
                      .style("fill", "red")
                      .on("mouseover", function(d,i) {      
                        div.transition()        
                          .duration(200)      
                          .style("opacity", .9);
                      
                        div.html('<h3>Aduana de: '+d.id +'</h3>' + '<p> Dirección:  '+d.Direccion+'</p>' + '<p><span>Tráfico:  </span>'+'<img class="l1"' + 'src="' +d.l1+ '">'  +'<img class="l2"' + 'src="' +d.l2+ '">' + '<img class="l3"' + 'src="' +d.l3+ '">' + '<img class="l4"' + 'src="' +d.l4+ '">' + '</p>'
                        )
                        .style("left", (d3.event.pageX) + "px")     
                        .style("top", (d3.event.pageY - 28) + "px");

                        div2.transition()        
                          .duration(200)      
                          .style("opacity", .9);
                      
                        div2.html('<h5>'+d.AAA_Nombre +'</h5>' +'<p> Dirección: '+ d.AAA_Direccion +'</p>' + '<p> Teléfono: <b>'+ d.AAA_Telefono +'</b></p>' + '<p>E-mail:  '+ d.AAA_Email +'</p>'
                        )
                        .style("left", (d3.event.pageX) + "px")     
                        .style("top", (d3.event.pageY + 180) + "px");

                        if(d.l1 === "No"){
                          $(".l1").css("display", "none")
                        }
                        if(d.l2 === "No"){
                          $(".l2").css("display", "none")
                        }
                        if(d.l3 === "No"){
                          $(".l3").css("display", "none")
                        }
                        if(d.l4 === "No"){
                          $(".l4").css("display", "none")
                        };

                        d3.select(this).transition()
                            .ease("elastic")
                            .duration("500")
                            .attr("r", 35);
                    })               
                    .on("mouseout", function(d) {       
                        div.transition()        
                           .duration(500)      
                           .style("opacity", 0);
                        div2.transition()        
                           .duration(500)      
                           .style("opacity", 0); 
                    });

                    var selectValue = d3.select('#selecId').property('value');
                    var selectValueAs = d3.select('#selecIdAs').property('value');

                     svg.selectAll("circle")
                      .data(data)
                      .attr("cx", function(d) {
                          if(selectValueAs === "Todas" || selectValueAs === d.AAA_Nombre){
                            return projection([d.lon, d.lat])[0];
                            update();
                            console.log("Tooodos cx") 
                          }
                          else if(selectValue === d.Estado && selectValueAs === d.AAA_Nombre){
                            return projection([d.lon, d.lat])[0];
                          }
                          else { return projection(["0","0"])[0]; console.log("Tooodos NO") }      
                      })
                      .attr("cy", function(d) {
                          if( selectValueAs === "Todas" || selectValueAs === d.AAA_Nombre){
                            return projection([d.lon, d.lat])[1];
                            update();
                            console.log("Tooodos cy")
                          }
                          else if(selectValue === d.Estado && selectValueAs === d.AAA_Nombre){
                            return projection([d.lon, d.lat])[1];
                          }
                          else { return projection(["0","0"])[1]; console.log("Tooodos NO") }
                      });





                  d3.select("#todos").on("change",update2);
                  d3.select("#Aereo").on("change",update);
                  d3.select("#Maritimo").on("change",update);
                  d3.select("#Terrestre").on("change",update);
                  d3.select("#Ferroviario").on("change",update);
                  update();

                  function update2(){
                    if( d3.select("#todos").property("checked") ){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(selectValue === "Todos"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(selectValue === d.Estado ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          } 
                        })
                        .attr("cy", function(d) {
                          if(selectValue === "Todos" ){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(selectValue === d.Estado){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Todos C")
                    }

                  }
                  
                  function update(){
                    $("input:checkbox").on( "click", function() { $("#selecIdAs").selectedIndex = 1 });

                    if(d3.select("#Aereo").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo === "Aereo" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo === "Aereo" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre ){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo === "Aereo" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo === "Aereo" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Aereo C")
                    } 
                    if(d3.select("#Maritimo").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo2 === "Maritimo" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo2 === "Maritimo" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo2 === "Maritimo" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo2 === "Maritimo" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Maritimo C")
                    }
                    if(d3.select("#Terrestre").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo3 === "Terrestre" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo3 === "Terrestre" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo3 === "Terrestre" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo3 === "Terrestre" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Terrestre C")
                    }
                    if(d3.select("#Ferroviario").property("checked")){
                      svg.selectAll("circle")
                        .data(data)
                        .attr("cx", function(d) {
                          if(d.Tipo4 === "Ferroviario" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[0];
                          }
                          else if(d.Tipo4 === "Ferroviario" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[0];
                          }
                          else{
                            return projection([0,0])[0];  
                          }   
                        })
                        .attr("cy", function(d) {
                          if(d.Tipo4 === "Ferroviario" && selectValue === "Todos" && selectValueAs === "Todas"){
                              return projection([d.lon, d.lat])[1]; 
                          }
                          else if(d.Tipo4 === "Ferroviario" && selectValue === "Todos" && selectValueAs === d.AAA_Nombre){
                              return projection([d.lon, d.lat])[1];
                          }
                          else{
                            return projection([0,0])[0];  
                          }
                        });
                      console.log("Ferroviario C")
                    }
                  };

              });  // END On chage (SELECT-OPTION-ASOCIACIÓN)


             




              


            /* Push the html states list DINAMICALLY !!!

                var selectID = d3.select('#selecId'),
                  selecIdAs = d3.select('#selecIdAs');

                var options = selectID
                .selectAll('#selecId')
                .data(json.features)
                .enter()
                .append('option')
                  .attr("value", function (d) {
                    return d.properties.name; 
                  })
                  .style("display", function (d) {
                    if( d.properties.aduanaExist === "true" ){
                      return "block";
                    }
                    else{
                      return "none";
                    }
                  })
                  .text(function (d) {
                    return d.properties.name;
                  });
                $("#selecId").prepend( '<option  selected="selected" >Selecciona el Estado</option>');    
                $("#selecId").prepend( '<option id="todosId" value="Todos">Todos</option>');
                $("#selecId option:nth-child(2)").css( "display", "none");


                var optionsAs = selecIdAs
                .selectAll('#selecIdAs')
                .data(data)
                .enter()
                .append('option')
                  .attr("value", function (d) {
                    return d.AAA_Nombre;
                    console.log(d.AAA_Nombre); 
                  })
                  .text(function (d) {
                    return d.AAA_Nombre;
                  });
                $("#selecIdAs").prepend( '<option  selected="selected" >Selecciona la Asociación</option>');    
                $("#selecIdAs").prepend( '<option id="todosIdAs" value="Todas">Todas</option>');
                $("#selecIdAs option:nth-child(2)").css( "display", "none"); */

            /* Ordena Alfabéticamente los elementos OPTION-HTML
                $( document ).ready(function() {
                var options = $('#selecId > option');
                    var arr = options.map(function(_, o) {
                        return {
                            t: $(o).text(),
                            v: o.value
                        };
                    }).get();
                    arr.sort(function(o1, o2) {
                        return o1.t > o2.t ? 1 : o1.t < o2.t ? -1 : 0;
                    });
                    options.each(function(i, o) {

                      if(options.value==="todos"){}
                      else{
                        console.log(i);
                        o.value = arr[i].v;
                        $(o).text(arr[i].t);
                      }
                        
                    });
                }); 

            $("#todos").click(function () {
                if ($(this).is(':checked')) {
                  $(this).siblings('#labelTodos').html('Todos');
                } else {
                  $(this).siblings('#labelTodos').html('Vacio');
                }
                if ($("#todos").is(':checked')) {
                    $("form input[type=checkbox]").each(function () {
                        $(this).prop("checked", true);
                    });

                } else {
                    $("form input[type=checkbox]").each(function () {
                        $(this).prop("checked", false);
                    });
                }
              });
              $(".others").click(function () {
                if ($(".others").is(':checked')) {
                    $("#todos").each(function () {
                        $(this).prop("checked", false);
                        $(this).siblings('#labelTodos').html('Algunos');
                    });

                } else {
                    $("form input[type=checkbox]").each(function () {
                        $(this).prop("checked", false);
                    });
                }
              }); 


                    
            $("#menu-item-30").append( '<ul class="serviciosMenuSub"><li><a href="http://www.congresocaaarem.com/caaarem/servicios/juridico/">Jurídico</a></li><li><a href="http://www.congresocaaarem.com/caaarem/servicios/operativo/">Operativo</a></li><li><a href="http://www.congresocaaarem.com/caaarem/caaarem-ti/">Tecnologías de la información</a></li></ul>');  

                    
            $("#menu-item-32").append( '<ul class="salaDePrensaMenuSub"><li style="position:relative;height:"><a href="http://www.congresocaaarem.com/caaarem/servicios/juridico/">Comunicados</a></li><li><a href="http://www.congresocaaarem.com/caaarem/servicios/operativo/">Síntesis CAAAREM</a></li><li><a href="http://www.congresocaaarem.com/caaarem/caaarem-ti/">lllll</a></li></ul>');

                    
            $("#menu-item-33").append( '<ul class="multimediaSub"><li><a href="http://www.congresocaaarem.com/caaarem/servicios/juridico/">Revista aduanas</a></li><li><a href="http://www.congresocaaarem.com/caaarem/servicios/operativo/">Videos y tutoriales</a></li></ul>');


            $( "#menu-item-30" ).mouseover(function() {
              $( ".serviciosMenuSub" ).css( "display", "block" );
            });
            $( "#menu-item-32" ).mouseover(function() {
              $( ".salaDePrensaMenuSub" ).css( "display", "block" );
            });
            $( "#menu-item-33" ).mouseover(function() {
              $( ".multimediaSub" ).css( "display", "block" );
            });

            $( "#menu-item-30" ).mouseout(function() {
              $( ".serviciosMenuSub" ).css( "display", "none" );
            });
            $( "#menu-item-32" ).mouseout(function() {
              $( ".salaDePrensaMenuSub" ).css( "display", "none" );
            });
            $( "#menu-item-33" ).mouseout(function() {
              $( ".multimediaSub" ).css( "display", "none" );
            }); */


  




                                           
        }); /* END CSV */
      }); /* END JSON */








</script>



</body>
</html>
